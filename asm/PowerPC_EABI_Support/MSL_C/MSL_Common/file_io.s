.include "macros.inc"

.section .text, "ax"  # 0x80039220 - 0x804F5900

.global fclose
fclose:
/* 802BE0B0 00287670  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 802BE0B4 00287674  7C 08 02 A6 */	mflr r0
/* 802BE0B8 00287678  2C 03 00 00 */	cmpwi r3, 0
/* 802BE0BC 0028767C  90 01 00 24 */	stw r0, 0x24(r1)
/* 802BE0C0 00287680  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 802BE0C4 00287684  93 C1 00 18 */	stw r30, 0x18(r1)
/* 802BE0C8 00287688  93 A1 00 14 */	stw r29, 0x14(r1)
/* 802BE0CC 0028768C  7C 7D 1B 78 */	mr r29, r3
/* 802BE0D0 00287690  40 82 00 0C */	bne lbl_802BE0DC
/* 802BE0D4 00287694  38 60 FF FF */	li r3, -1
/* 802BE0D8 00287698  48 00 00 78 */	b lbl_802BE150
lbl_802BE0DC:
/* 802BE0DC 0028769C  80 03 00 04 */	lwz r0, 4(r3)
/* 802BE0E0 002876A0  54 00 57 7F */	rlwinm. r0, r0, 0xa, 0x1d, 0x1f
/* 802BE0E4 002876A4  40 82 00 0C */	bne lbl_802BE0F0
/* 802BE0E8 002876A8  38 60 00 00 */	li r3, 0
/* 802BE0EC 002876AC  48 00 00 64 */	b lbl_802BE150
lbl_802BE0F0:
/* 802BE0F0 002876B0  48 00 00 7D */	bl fflush
/* 802BE0F4 002876B4  81 9D 00 44 */	lwz r12, 0x44(r29)
/* 802BE0F8 002876B8  7C 7E 1B 78 */	mr r30, r3
/* 802BE0FC 002876BC  80 7D 00 00 */	lwz r3, 0(r29)
/* 802BE100 002876C0  7D 89 03 A6 */	mtctr r12
/* 802BE104 002876C4  4E 80 04 21 */	bctrl 
/* 802BE108 002876C8  80 1D 00 08 */	lwz r0, 8(r29)
/* 802BE10C 002876CC  38 A0 00 00 */	li r5, 0
/* 802BE110 002876D0  80 9D 00 04 */	lwz r4, 4(r29)
/* 802BE114 002876D4  7C 7F 1B 78 */	mr r31, r3
/* 802BE118 002876D8  54 00 27 FF */	rlwinm. r0, r0, 4, 0x1f, 0x1f
/* 802BE11C 002876DC  90 BD 00 00 */	stw r5, 0(r29)
/* 802BE120 002876E0  54 84 02 8C */	rlwinm r4, r4, 0, 0xa, 6
/* 802BE124 002876E4  90 9D 00 04 */	stw r4, 4(r29)
/* 802BE128 002876E8  41 82 00 0C */	beq lbl_802BE134
/* 802BE12C 002876EC  80 7D 00 1C */	lwz r3, 0x1c(r29)
/* 802BE130 002876F0  4B FF E0 6D */	bl free
lbl_802BE134:
/* 802BE134 002876F4  2C 1E 00 00 */	cmpwi r30, 0
/* 802BE138 002876F8  38 00 00 00 */	li r0, 0
/* 802BE13C 002876FC  40 82 00 0C */	bne lbl_802BE148
/* 802BE140 00287700  2C 1F 00 00 */	cmpwi r31, 0
/* 802BE144 00287704  41 82 00 08 */	beq lbl_802BE14C
lbl_802BE148:
/* 802BE148 00287708  38 00 00 01 */	li r0, 1
lbl_802BE14C:
/* 802BE14C 0028770C  7C 60 00 D0 */	neg r3, r0
lbl_802BE150:
/* 802BE150 00287710  80 01 00 24 */	lwz r0, 0x24(r1)
/* 802BE154 00287714  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 802BE158 00287718  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 802BE15C 0028771C  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 802BE160 00287720  7C 08 03 A6 */	mtlr r0
/* 802BE164 00287724  38 21 00 20 */	addi r1, r1, 0x20
/* 802BE168 00287728  4E 80 00 20 */	blr 

.global fflush
fflush:
/* 802BE16C 0028772C  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 802BE170 00287730  7C 08 02 A6 */	mflr r0
/* 802BE174 00287734  2C 03 00 00 */	cmpwi r3, 0
/* 802BE178 00287738  90 01 00 14 */	stw r0, 0x14(r1)
/* 802BE17C 0028773C  93 E1 00 0C */	stw r31, 0xc(r1)
/* 802BE180 00287740  7C 7F 1B 78 */	mr r31, r3
/* 802BE184 00287744  93 C1 00 08 */	stw r30, 8(r1)
/* 802BE188 00287748  40 82 00 0C */	bne lbl_802BE194
/* 802BE18C 0028774C  4B FF E1 E5 */	bl __flush_all
/* 802BE190 00287750  48 00 00 F8 */	b lbl_802BE288
lbl_802BE194:
/* 802BE194 00287754  88 03 00 0A */	lbz r0, 0xa(r3)
/* 802BE198 00287758  2C 00 00 00 */	cmpwi r0, 0
/* 802BE19C 0028775C  40 82 00 10 */	bne lbl_802BE1AC
/* 802BE1A0 00287760  80 83 00 04 */	lwz r4, 4(r3)
/* 802BE1A4 00287764  54 80 57 7F */	rlwinm. r0, r4, 0xa, 0x1d, 0x1f
/* 802BE1A8 00287768  40 82 00 0C */	bne lbl_802BE1B4
lbl_802BE1AC:
/* 802BE1AC 0028776C  38 60 FF FF */	li r3, -1
/* 802BE1B0 00287770  48 00 00 D8 */	b lbl_802BE288
lbl_802BE1B4:
/* 802BE1B4 00287774  54 80 2F 7E */	rlwinm r0, r4, 5, 0x1d, 0x1f
/* 802BE1B8 00287778  28 00 00 01 */	cmplwi r0, 1
/* 802BE1BC 0028777C  40 82 00 0C */	bne lbl_802BE1C8
/* 802BE1C0 00287780  38 60 00 00 */	li r3, 0
/* 802BE1C4 00287784  48 00 00 C4 */	b lbl_802BE288
lbl_802BE1C8:
/* 802BE1C8 00287788  80 83 00 08 */	lwz r4, 8(r3)
/* 802BE1CC 0028778C  54 80 1F 7E */	srwi r0, r4, 0x1d
/* 802BE1D0 00287790  28 00 00 03 */	cmplwi r0, 3
/* 802BE1D4 00287794  41 80 00 10 */	blt lbl_802BE1E4
/* 802BE1D8 00287798  38 00 00 02 */	li r0, 2
/* 802BE1DC 0028779C  50 04 E8 04 */	rlwimi r4, r0, 0x1d, 0, 2
/* 802BE1E0 002877A0  90 83 00 08 */	stw r4, 8(r3)
lbl_802BE1E4:
/* 802BE1E4 002877A4  80 03 00 08 */	lwz r0, 8(r3)
/* 802BE1E8 002877A8  54 00 1F 7E */	srwi r0, r0, 0x1d
/* 802BE1EC 002877AC  28 00 00 02 */	cmplwi r0, 2
/* 802BE1F0 002877B0  40 82 00 0C */	bne lbl_802BE1FC
/* 802BE1F4 002877B4  38 00 00 00 */	li r0, 0
/* 802BE1F8 002877B8  90 03 00 28 */	stw r0, 0x28(r3)
lbl_802BE1FC:
/* 802BE1FC 002877BC  80 83 00 08 */	lwz r4, 8(r3)
/* 802BE200 002877C0  54 80 1F 7E */	srwi r0, r4, 0x1d
/* 802BE204 002877C4  28 00 00 01 */	cmplwi r0, 1
/* 802BE208 002877C8  41 82 00 14 */	beq lbl_802BE21C
/* 802BE20C 002877CC  54 80 00 FE */	clrlwi r0, r4, 3
/* 802BE210 002877D0  90 03 00 08 */	stw r0, 8(r3)
/* 802BE214 002877D4  38 60 00 00 */	li r3, 0
/* 802BE218 002877D8  48 00 00 70 */	b lbl_802BE288
lbl_802BE21C:
/* 802BE21C 002877DC  80 03 00 04 */	lwz r0, 4(r3)
/* 802BE220 002877E0  54 00 57 7E */	rlwinm r0, r0, 0xa, 0x1d, 0x1f
/* 802BE224 002877E4  28 00 00 01 */	cmplwi r0, 1
/* 802BE228 002877E8  41 82 00 0C */	beq lbl_802BE234
/* 802BE22C 002877EC  3B C0 00 00 */	li r30, 0
/* 802BE230 002877F0  48 00 00 10 */	b lbl_802BE240
lbl_802BE234:
/* 802BE234 002877F4  7F E3 FB 78 */	mr r3, r31
/* 802BE238 002877F8  48 00 01 11 */	bl ftell
/* 802BE23C 002877FC  7C 7E 1B 78 */	mr r30, r3
lbl_802BE240:
/* 802BE240 00287800  7F E3 FB 78 */	mr r3, r31
/* 802BE244 00287804  38 80 00 00 */	li r4, 0
/* 802BE248 00287808  4B FF FA A9 */	bl __flush_buffer
/* 802BE24C 0028780C  2C 03 00 00 */	cmpwi r3, 0
/* 802BE250 00287810  41 82 00 1C */	beq lbl_802BE26C
/* 802BE254 00287814  38 60 00 01 */	li r3, 1
/* 802BE258 00287818  38 00 00 00 */	li r0, 0
/* 802BE25C 0028781C  98 7F 00 0A */	stb r3, 0xa(r31)
/* 802BE260 00287820  38 60 FF FF */	li r3, -1
/* 802BE264 00287824  90 1F 00 28 */	stw r0, 0x28(r31)
/* 802BE268 00287828  48 00 00 20 */	b lbl_802BE288
lbl_802BE26C:
/* 802BE26C 0028782C  80 1F 00 08 */	lwz r0, 8(r31)
/* 802BE270 00287830  38 80 00 00 */	li r4, 0
/* 802BE274 00287834  93 DF 00 18 */	stw r30, 0x18(r31)
/* 802BE278 00287838  38 60 00 00 */	li r3, 0
/* 802BE27C 0028783C  54 00 00 FE */	clrlwi r0, r0, 3
/* 802BE280 00287840  90 1F 00 08 */	stw r0, 8(r31)
/* 802BE284 00287844  90 9F 00 28 */	stw r4, 0x28(r31)
lbl_802BE288:
/* 802BE288 00287848  80 01 00 14 */	lwz r0, 0x14(r1)
/* 802BE28C 0028784C  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 802BE290 00287850  83 C1 00 08 */	lwz r30, 8(r1)
/* 802BE294 00287854  7C 08 03 A6 */	mtlr r0
/* 802BE298 00287858  38 21 00 10 */	addi r1, r1, 0x10
/* 802BE29C 0028785C  4E 80 00 20 */	blr 